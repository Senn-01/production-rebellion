# Production Rebellion - Project Brief 

IMPORTANT NOTE: THIS IS STILL IN PLANNING PHASE. NO IMPLEMENTATION YET.

## Overview 

### Core Philosophy

#### White Board Thinking (messy, but useful)
 1. NOT a task management/project management/Calendar/todo replacement - They're positioning it as a meta-layer ABOVE existing tools --> Objective is a Strategic Productivity Reflection tool by combining strategic map of all projects (cost/benefit/priority as a helper user to decide where to put his effort) and deep focus session tracking (to make him aware of his patterns and push him for deep work session through strava-like gamification reward).

  2. Two core functions:
    - OVERVIEW: Visual project tracking (cost/benefit matrix) for completed projects - analytics over time
    - DEEP FOCUS: Gamified focus sessions with self-awareness about performance
  3. Capture is a bonus -  GTD-inspired triage workflow
  4. Small, opinionated app - Not trying to compete with big tools, just filling a specific gap but based on a solid philosophy, and research. (Rigardo Vargas' Time Management paper, 'Power of Habit', 'Deep Work' by Cal Newport --> see annexes below)

  This is actually a much clearer positioning. Let me rethink this:

  - They're NOT competing with Todoist/Notion/Jira
  - They're creating a reflection/tracking layer on TOP of those tools
  - The cost/benefit matrix is for strategic REVIEW, not daily task management
  - The focus sessions are about building awareness of deep work patterns

  This makes much more sense. The app is about:
  1. Strategic reflection on what you've accomplished
  2. Building deep work habits with self-awareness
  3. NOT about managing the actual work itself

  Production Rebellion is NOT a todo app competitor. It's a meta-reflection tool that answers two questions:

  1. "What have I actually accomplished?" - Visual overview of completed projects with cost/benefit analysis
  2. "How well do I focus?" - Gamified deep work tracking with self-awareness metrics

  You're building the Strava of productivity - not managing the run, but tracking performance and patterns after the fact.
1. Project Overview/Retrospective - A place to mark projects as DONE after completing them elsewhere (Jira, Notion, etc.), then see analytics of what they've accomplished
  2. Deep Focus Gamification - Track and improve focus sessions with self-awareness

   â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Your clarification changes everything. Production Rebellion isn't competing with Todoist - it's competing with RescueTime and retrospective tools. You're building the "Strava of
  productivity" - users do their actual work elsewhere, then come to you for strategic reflection and performance tracking.


  The Real Competition (Now That I Understand):

  Productivity Analytics Tools:
  - RescueTime ($12/mo) - Automatic tracking but no project overview or strategic view
  - Toggl Track ($9/mo) - Time tracking with reports but no cost/benefit analysis
  - ActivTrak - Workforce analytics but corporate/creepy
  - Clockify - Time sheets but no gamification

  ##### SWOT Analysis
  Strengths âœ…

  - The Cost/Benefit Matrix is Unique: No analytics tool visualizes completed projects this way
  - Gaming Difficulty Levels for Deep Work: Nobody else treats focus sessions like video game challenges
  - Retrospective Focus: You're not managing chaos, you're celebrating completion
  - Small Surface Area: By NOT being a task manager, you avoid feature creep
  - Clear Value Prop: "See what you've actually accomplished and how well you focused"
  - Fills Critical GTD Gap: The missing visual evaluation layer before commitment
  - Forces Strategic Thinking: Can't add project without scoring cost/benefit
  - Visual Clarity: See your ENTIRE commitment landscape at once
  - Continuous Strategy: ongoing strategic decisions

  Weaknesses ðŸ¤”

  - Manual Entry Required: Users must remember to mark projects complete (unlike RescueTime's automation)
  - Delayed Gratification: Value comes AFTER work is done, not during
  - Desktop-Only Still Hurts: Can't mark project complete from phone after finishing
  - No Integration Initially: Can't pull completed tasks from Jira/Notion automatically
  - Education Still Needed: "Why score my completed projects?" requires explanation
  - Manual Scoring Required: But this friction is THE FEATURE - forces reflection
  - Desktop-First: Acceptable since strategic evaluation happens at desk, not on-the-go
  - Learning Curve: But GTD users already understand the need for systematic thinking
  - No Integration Initially: Can't pull completed tasks from Jira/Notion automatically

  Opportunities ðŸš€

  - Underserved Niche: People who want strategic reflection, not more task management
  - Post-Productivity Culture: Users tired of "optimization" wanting self-awareness instead
  - Weekly Review Market: Perfect for Sunday planning sessions
  - Complement Not Compete: Works alongside Todoist/Notion, not against them
  - AI Enhancement Path: "You complete similar projects 40% faster now"
  - GTD Community: 15+ million people use GTD - you solve their biggest pain
  - The Vargas Problem: Everyone overcommits - you're the cure
  - Integration Path Clear: "Import from Things/OmniFocus/Todoist" = instant value
  - Corporate Training: Teams could use this for project portfolio management
  
  Threats âš ï¸

  - Low Engagement Risk: Retrospective tools used weekly, not daily
  - Habit Formation Challenge: Harder to build habit around reflection vs. daily tasks
  - Perceived Value: "$60 for something I use once a week?"
  - Feature Pressure: Users will still ask for task management features

  My Honest Assessment Now

  This positioning is MUCH stronger. You're not David fighting Goliath (Todoist). You're creating a new category: Strategic Productivity Reflection.

  Why This Can Work:

  1. Clear Lane: RescueTime tracks time automatically but gives no strategic overview. You provide the strategic layer they're missing.
  2. Strava Model Proven: Strava doesn't help you run - it celebrates your runs. 135M users pay for reflection and gamification.
  3. Cognitive Load Actually Reduced: By NOT managing tasks, you truly reduce burden. Users just mark things done and see patterns.
  4. Price Justification Better: $60 for a reflection tool feels more reasonable than $60 for another todo app.
  Why This Can Work:

  1. Clear Lane: RescueTime tracks time automatically but gives no strategic overview. You provide the strategic layer they're missing.
  2. Strava Model Proven: Strava doesn't help you run - it celebrates your runs. 135M users pay for reflection and gamification.
  3. Cognitive Load Actually Reduced: By NOT managing tasks, you truly reduce burden. Users just mark things done and see patterns.
  4. Price Justification Better: $60 for a reflection tool feels more reasonable than $60 for another todo app.

  Critical Success Factors:

  1. Make "Mark as Complete" Frictionless
    - Quick mobile web UI just for completion
    - Weekly email: "What did you finish this week?" with quick-add links
    - Browser extension: "Mark complete from anywhere"
  2. Weekly Habit, Not Daily
    - Position as "Sunday Strategic Review"
    - Weekly email with achievements
    - "Your week in review" summary
  3. Deep Focus as Daily Hook
    - This is your daily engagement
    - Focus sessions keep users coming back
    - Projects get marked complete naturally after focus work
  4. Integration Roadmap Clear
    - "Coming Soon: Auto-import from Jira"
    - "Future: Notion completed tasks sync"
    - Shows you understand the workflow

âº â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The brilliance of Production Rebellion isn't in what it does - it's in what it deliberately DOESN'T do. By refusing to manage tasks, you've found clear water in an ocean of todo apps.

"Is this project worth the cost?" BEFORE it enters the
  execution system.

My Final Assessment

  This is fucking brilliant.

  Production Rebellion isn't a productivity app - it's a commitment firewall. It forces the strategic pause that prevents productivity system collapse.

  The Killer Use Case:

  Sunday GTD Weekly Review:
  1. Process inbox in OmniFocus/Things
  2. Open Production Rebellion
  3. See current project landscape visually
  4. Evaluate new potential projects against what's already there
  5. Only commit to what fits the map
  6. Mark completed projects from last week
  7. Check deep focus performance

  Why This Wins:

  1. You're Not Replacing GTD - You're fixing its biggest weakness
  2. The Visual Map IS the Value - Nobody else shows commitment landscape
  3. Forced Limits Create Freedom - 20 projects max = sustainable productivity
  4. Cost/Benefit Scoring = Strategic Thinking - Not just "what" but "why"

  Critical Success Factors:

  1. Position as GTD Enhancement
    - "The visual layer GTD is missing"
    - "See your commitments before you commit"
    - "Ricardo Vargas' cost/benefit matrix, but continuous"
  2. Solo Developer Advantages
    - Move fast, no committees
    - Opinionated design (20 project limit non-negotiable)
    - Humor about limitations: "Sorry, can't import from carrier pigeon"
  3. Embrace the Friction
    - Manual scoring IS the feature
    - "2 minutes to score = 20 hours saved from bad projects"

CRITICAL THINKING skills


#### Current Version

**Production Rebellion** - A project management META-LAYER tool that transforms how users manage their projects. It integrates GTD (Getting Things Done) principles with strategic visualization, deep focus session tracking, data-driven insights, and subtle gamification for motivation. 

We are not trying to be another todo app, take market share from Notion, replace Google Calendar, or track health habits. We want to position ourselves above that, and will provide routing to those apps when users "triage" their captured thoughts. We want users to have a clear view of what they could work on based on their personal ranking (cost/benefit/priority), clearly and smartly presented on a "strategic map" (cost/X-Axis, benefit/Y-Axis, color gradient for priorities, pulsing when due date is close).

**This app aims to give user an appealing overview of his projects (in order for him to analyse critically where he wants to puts his effort) and a focus tool to understand his patterns, push him for deep work session through strava-like gamification reward.**

### Core Features Overview

The user experience flows through **four distinct "paintings" (pages)**, each serving a specific purpose:

1. **Tactical Map** - Strategic project visualization on a cost/benefit scatter plot with visual prioritization
2. **Deep Focus** -  deep work sessions with willpower tracking and gamified difficulty levels  
3. **Analytics** - Data-driven insights with heatmaps, treemaps, and achievement tracking
4. **Prime** - Personal operating system with values definition and daily reflection

**Universal Systems** present across all paintings:
- **App Header with Capture Bar** - Brand identity and navigation menu,  Frictionless thought capture with GTD-inspired triage workflow
- **XP System** - Cool visual rewards that appear as a gauge (âš¡ icon + points) in top-right
- **Navigation Grid** - Fixed bottom-right 2x2 quadrant for seamless page switching
- **Achievement Framework** - Discovery-based unlocks tracked through user behavior

### Design Principles Summary

1. **Make every detail perfect and limit the number of details to perfect** : Choose depth over breadth. Each feature polished before the next. Three perfect features over ten mediocre ones.
2. **Intuitive by Design** : If it needs explanation, redesign it. The interface teaches itself through visual enhancement. Understanding through discovery.
3. **Light Through Function** :Clarity emerges through use. Moments of quiet revelation. Understanding unfolds naturally, like dawn breaking.
4. **Brutally Modern, Elegant** : we embrace totally the neo-brutalism design for this app. Functional, killer visual. Bold geometric forms, decisive typography. Beauty through functional precision.
5. **Visual-First Principle**: The interface teaches through visual patterns, not words. We speak through our visuals. Users get curious and explore.
6. **Minimum Friction**
7. **Everything is Data**: Track for insights, display for motivation
8. **Gamification**: 
10. **Cue/Habits/Rewards System**: Help users understand themselves better, without explaining but by guiding their process. We never patronize or hand-hold.

### Tone
The app radiates **"productive rebellion"** - serious about results but playful in approach
- **Direct and functional** - Say what things do, not why they're amazing
- **Self-aware and auto-derision** - as a solo-developer, we are not trying to build Netflix. We know our limitaion and acknowledge them with humor.
- **Subtly playful** - Gaming/tech references that enhance, never distract
- **Respectfully intelligent** - Trust intelligence without explaining the obvious, user should read in-between the lines our jokes.
- **Dry, clever humor without being try-hard** : Confident Simplicity with Dry Wit
- **keep it chill, no need for theatrical bullshit**

### Target User Profile

This app speaks to **anyone** that has a list of projects and is motivate to transform ideas into concrete.
They need a little and clever help to have a perspective view, and a tool to understand their patterns in a well-designed and functional visualapp. They include (not exhaustive):

- **The Academic**: PhD students managing research, teaching, and life - need visual clarity for projects
- **The Creative Professional**: Freelance designers, writers, architects 
- **The Knowledge Worker**: Developers, consultants, analysts - drowning in initiatives at work and side projects at home
- **The Entrepreneur**: Building while maintaining day job - need to maximize limited focus time
- **The Multi-Passionate**: People with diverse interests - struggling to balance learning, creating, and doing

What unites them:
- They are motivated, but lack a cool tool to keep track of their projects.
- Appreciation for visual organization over endless lists

## "Paintings"

### Phase 1: Components Present on all *Paintings* 
Fixed top header across all paintings containing:
- **Left**:  text logo
- **Right**: menu icon for settings/profile (future expansion)

#### Universal Capture Bar
**improtant note**: Color of this header will vary depending on the painting. (for header label, capture button, hamburger menu)

##### Rationale
In the header (middle positioning), to provide a frictionless, always-accessible method for capturing thoughts the moment they occur, adhering to the core "capture" principle of GTD. This decouples the act of capturing from the act of organizing, preventing context-switching and reducing cognitive load.

##### UX Flow

**Capture Flow:**
The capture bar sits directly in the app header, always visible across all paintings. When the user has a thought, they click (or CMD + C) on the static input bar labeled "Brain Dump". This transforms into an active textarea where they can type freely. They submit by clicking "Capture" or using Cmd/Ctrl+Enter. 
Then on the Tactical Map, a badge appears next to "Triage" showing pending items count. note : badge appear only if "triage" was empty before, otherwise only count is updated.

**Triage Flow:**
When the user decides to triage (clicking the "Triage" button on Tactical Map), a modal opens showing items one by one with these options:
- "Track Project" â†’ Opens ProjectCreator modal (same as "+ add a project" button - see below)
- "Parking Lot" â†’ Moves to Parking Lot  
- "Doing it now." â†’ remove from system
- "Routing" â†’ Placeholder for future integrations (Notion/Todoist/Calendar)
- "Delete" â†’ Removes from system

After each decision, once full action is over, the system moves to the next item.

##### Business Logic

When a capture is submitted:
1. Create capture item with status 'pending' in database
2. Record the source painting (which page user was on)
3. Check if first capture ever - if yes, unlock achievement 
4. Update pending count for Tactical Map badge
5. Log capture timestamp for analytics
6. Reset capture bar to static state

During triage:
1. Display oldest item first
2. Record decision 
3. Log triage timestamp
4. Execute decision (create project, move to parking lot, etc.)
5. Auto-advance to next item or close if done

##### Data Captured

**Timing Data:**
- Capture timestamp - When exactly the thought occurred
- Triage timestamp - When they actually processed it  
- Time to decision - How long between seeing an item and deciding what to do with it

**Flow Data:**
- Source painting - Which page were they on when capturing (Map/Focus/Analytics/Prime)
- Triage decision - What they chose to do with each item (project/parking/quick/routing/delete)

**For each capture item:**
- Content text (no character limit)
- Status (pending/triaged)
- User ID (from auth.users)

##### Component Breakdown

**CaptureBar** - Main header component
- Manages expanded/collapsed state
- Handles text input and submission
- Shows in header across all paintings

**TriageModal** - Decision interface
- Shows one item at a time
- Presents five decision options
- Auto-advances through queue

**TriageBadge** - Count indicator
- Only visible on Tactical Map
- Shows number of pending items
- Positioned near "Add Project" and "Parking Lot" buttons

#### Navigation System

##### Rationale
Fixed navigation ensures users always know where they are and can quickly switch between the four paintings. The 2x2 grid reinforces the spatial concept while colors provide immediate visual orientation.

##### UX Flow

A 2x2 grid sits fixed in the bottom-right corner with four quadrants: "Map" (top-left), "Focus" (top-right), "Data" (bottom-left), "Prime" (bottom-right). 

The current painting is highlighted with its dominant color. Hovering over another quadrant shows a subtle preview. Clicking triggers a smooth page transition via Framer Motion.

Keyboard shortcuts for quick switching:
- Alt + 1: Map (or Cmd/Ctrl + Shift + 1)
- Alt + 2: Focus (or Cmd/Ctrl + Shift + 2)
- Alt + 3: Data (or Cmd/Ctrl + Shift + 3)
- Alt + 4: Prime (or Cmd/Ctrl + Shift + 4)

#### XP Points Display

##### Rationale
gamification that rewards without visual animation when earned. The XP system provides continuous positive reinforcement for all productive behaviors. Visual-only feedback (âš¡ icon with numbers).

##### Position & Display
Fixed in top-right corner below the header, showing "âš¡ 1,250" format (current week's points). Resets weekly on Monday. On hover, shows tooltip: "Points earned this week from completing projects and focus sessions".

##### Business Logic

When XP is earned anywhere in the app:
1. Calculate points based on the event (project completion, focus session, etc.)
2. Add to weekly total
3. Trigger animation: number counts up from old value to new value
4. Display subtle pulse or glow effect during the count-up
5. Return to static state after animation completes

The component listens for XP events from all paintings and updates accordingly. No explanatory text, just visual feedback.

*Detailed XP calculation formulas and multipliers described in Analytics section below.*

**Weekly Review:**
On Sunday afternoon (or first login after), prompt user to review their week in Analytics before starting fresh. XP resets Monday 00:00 local time.


### Phase 2: "Tactical Map" Painting (Main Page)

#### Rationale
To provide a strategic, visual decision-making arena. This page answers, "Of all the things I could do, what should I do?" The Cost vs. Benefit matrix forces users to evaluate projects based on strategic value and priorities at ease. The triage queue and parking lot serve as essential control points for managing the flow of work. This is our crucial, visual painting - information flows from visuals. 

#### UX Flow

**Main View:**
The application's main landing page presents the Cost vs. Benefit Matrix. Projects appear as shapes on the grid (0-10 scale for both axes). Shadow Border represent priority levels (Gold, Black, Grey respectively for must/should/nice), All categories are in a rectangle format, they differentiate by pattern inside (hozitonal line, vertical line, diagonal line, filled-in) and shades of greys. 

**Project Interactions:**
- Click on project: Opens options to edit, mark completed, or abandon
- When completed: Project disappears with animation, XP bar animates up
- Boss Battle: User can designate one project at a time as Boss Battle (2x XP bonus). Can select new one after completing current

**Visual Handling:**
- Projects with cannot have same cost/benefit values in MVP. errors handled gracefully with humor and propose to offset by 1.
- Edge cases (e.g., cost 10, benefit 10) render gracefully within map boundaries
- Visible but Inactive projects appear dimmed at 60% opacity
- Projects with approaching deadlines (â‰¤3 days) show gentle pulse animation

**Buttons Controls:**
Above the chart, three action buttons:
- "Add Project" - Opens ProjectCreator modal for direct project creation
- "Parking Lot" - Shows someday/maybe items list
- "Triage (n)" - Appears when capture items are pending

**Chartheader :**
On the left: Cost vs Benefit Analysis Label and on second line : xx project visible
On the right on two lines also, a non-verbose legend of categories, boss-battle, and priority levels.
**Modal Flows:**
- Triage: Processes pending captures one by one (see Phase 1)
- Add Project: Direct creation shortcut when user knows they want to track something
- Parking Lot: Simple list modal showing items
  - Each item shows text and date added
  - Two actions: "Promote to Project" (opens ProjectCreator) or "Delete"
  - Items come from triage when user selects "That's for my Future/Maybe List. In my Parking Lot"

#### Business Logic

**Data Loading:**
1. Fetch all projects for user (active and inactive)
2. Apply view filter (this week vs all)
3. Calculate positions based on cost/benefit scores
4. Handle overlapping positions with offset algorithm
5. Apply visual states (opacity, colors, animations)

**Project State Management:**
- Create: Add new project with all fields, set initial status
- Update: Edit cost/benefit/priority/status
- Complete: Show accuracy check, record result, trigger XP calculation, remove from map
- Abandon: Mark as abandoned, moves to graveyard (shown in Analytics)
- Activate/Deactivate: Toggle active status
- Set Boss Battle: Mark one project as weekly boss battle (only one active at a time, can set new after completion)

**Triage Integration:**
- Monitor pending capture count
- Show/hide Triage button based on count
- Handle triage decisions that create new projects

**Achievement Triggers (10 Total for MVP):**
- "First Blood" - COUNT(projects WHERE status = 'completed') = 1
- "Double Digits" - COUNT(projects WHERE status = 'completed') >= 10
- "Giant Slayer" - EXISTS(projects WHERE cost = 10 AND status = 'completed')
- "Dark Souls Mode" - EXISTS(projects WHERE was_boss_battle = true AND confidence = 'low' AND status = 'completed')
- "Frame Perfect" - EXISTS(projects WHERE DATE(completed_at) = due_date)
- "Centurion" - SUM(sessions.duration WHERE completed = true) >= 6000
- "Dedicated" - COUNT(week_streaks WHERE has_session = true) >= 4
- "The Grind" - SUM(sessions.duration WHERE date = today) >= 600
- "The Estimator" - COUNT(projects WHERE confidence = 'high' AND accuracy = 'accurate') >= 5
- "No-Brainer King" - COUNT(projects WHERE cost <= 5 AND benefit >= 5 AND status = 'completed') >= 10

#### Data Captured

**Project Data (DB fields):**
- cost: integer (1-10, minimum 1)
- benefit: integer (1-10, minimum 1)
- priority: enum ('must', 'should', 'nice')
- category: enum ('work', 'learn', 'build', 'manage')
- status: enum ('active', 'inactive', 'completed', 'abandoned')
- is_boss_battle: boolean
- was_boss_battle: boolean (snapshot at completion)
- created_at: timestamp
- completed_at: timestamp
- confidence: enum ('high', 'medium', 'low')
- accuracy: enum ('accurate', 'easier', 'harder') - null until completed
- due_date: date (optional)

**Business Rules (MVP Limitations - NOT Strategic Features):**
- **20-Project Maximum** (MVP constraint - solo dev can only handle so much state)
  - This is a technical limitation, not a design philosophy
  - Will be removed/increased in future versions
  - When at 20-project limit, must complete or abandon projects before adding new ones
  - **Project Limit UI**: At 19 active projects, show warning badge "19/20 projects". At 20 projects, "Add Project" button shows "Complete a project first" modal
- **Coordinate Collision Prevention** (MVP constraint - avoided complex positioning algorithm to ship faster)
  - No two active/inactive projects can occupy same (cost, benefit) position
  - This is a technical shortcut, not intentional friction
  - Will add smart positioning/clustering in v2
  - Database constraint enforces uniqueness
  - Check happens before project creation
  - Collision shows error: "Spot taken at (X,Y). Could've built smart positioning, chose to ship instead. Try cost Â± 1?"
  - Suggests 3 nearby available coordinates
- Completed projects never count toward the 20-project limit (immediately free up space)
- Abandoned projects also don't count toward limit (move to graveyard)
- Projects cannot be edited after status = 'completed'
- **Boss Battle Locking**: Boss Battle locks when first focus session timer starts. New Boss Battle can only be designated after current one is completed or abandoned
- Only one project can be Boss Battle at a time (can designate new one only after completing current Boss Battle)
- Cost and benefit must be between 1-10 (no zero values)

#### Component Breakdown

**TacticalMap** - Main container
- Manages all project state
- Handles view filtering
- Coordinates with modals

**Matrix** - Visual chart
- Renders project positions
- Handles click interactions
- Manages animations

**ProjectNode** - Individual project on map
- Shows shape based on category
- Displays priority through color
- Handles hover/click states

**MapControls** - Header buttons
- Add Project, Parking Lot, Triage
- Toggle switch for view filter


#### ProjectCreator Modal

##### Rationale
Provides structured project creation with guided scoring to ensure consistent evaluation. The modal helps users think strategically about effort vs impact before committing to track a project.

##### UX Flow

The modal opens when user clicks "Add Project" or chooses "Track on Map" during triage.

**Field Entry Process:**
1. **Project Name** - Required, clear title
2. **Cost Score (1-10)** - With guidance:
   - 1-3: Quick wins (<5 hours) - "Could finish in one sitting"
   - 4-6: Moderate effort (5-20 hours) - "Multiple work sessions needed" 
   - 7-10: Major undertaking (>20 hours) - "Significant time investment"
3. **Benefit Score (1-10)** - With guidance:
   - 1-3: Minor improvement - "Nice to have, marginal benefit"
   - 4-6: Notable progress - "Clear value, moves the needle"
   - 7-10: Game-changer - "Transformative, unlocks new possibilities"
4. **Category** - Select ONE:
   - Work: Career, clients, income-generating (DB: 'work')
   - Learn: Education, skill development (DB: 'learn')
   - Build: Creating, side ventures (DB: 'build')
   - Manage: Health, relationships, maintenance (DB: 'manage')
5. **Priority** - Choose one:
   - Must-Do (Critical/Deadline-driven) - DB: 'must'
   - Should-Do (Important but flexible) - DB: 'should'
   - Nice-to-Have (Valuable when time permits) - DB: 'nice'
6. **Due Date** - Optional date picker
7. **Description/Links** - Optional text area for context
8. **Status** - Select:
   - Active: Ready to work on (DB: 'active')
   - Inactive: Not current focus (DB: 'inactive')
9. **Confidence** - Required (last field): "Confidence level?"
   - Don't you dare question my ability to estimate (DB: 'high')
   - Trying my best (DB: 'medium')
   - Total assumed guess (DB: 'low')

After submission, project immediately appears on the map at calculated position.

##### Business Logic

When project is created:
1. Validate required fields (name, cost, benefit, category, confidence)
2. **Check for coordinate collision**:
   - Call `check_coordinate_availability(user_id, cost, benefit)`
   - If position taken:
     - Get suggestions via `suggest_nearby_coordinates()`
     - Show error with solo-dev humor:
       - "Collision at (5,5). Yeah, I could've built smart positioning, but I was debugging the XP counter for 3 hours. Just nudge it by 1?"
       - "Spot taken. Offset algorithm is on the roadmap, right after 'make it actually work'. Try cost Â± 1?"
       - "Two projects, same spot. Classic n+1 problem I'll fix after launch. Shift your scores a bit?"
     - Display suggested coordinates as clickable buttons
   - If position available, proceed to step 3
3. Calculate quadrant position based on scores
4. Save to database with created_at timestamp and confidence level
5. If coming from triage, mark capture item as processed
6. Check for first project achievement
7. Update map visualization
8. Close modal

**Collision Error Messages (rotate randomly):**
- "Collision at ({cost},{benefit}). Should've used a quadtree but went with a simple check. Solo dev life."
- "That spot's taken. Spent the collision-handling time on that sick difficulty naming. Worth it."
- "Coordinate occupied. My bad - prioritized the achievement system over spatial algorithms."
- "Position conflict. The joys of MVPs - some features are MVP-er than others."
- "Duplicate coordinates. I promise v2 will have smart clustering. v1 has... this message."

##### Component Breakdown

**ProjectCreator** - Modal container
- Form validation
- Submission handling
- Pre-fills from triage if applicable

**ScoreSlider** - Reusable scoring component
- Shows numeric value
- Displays contextual guidance
- Visual feedback on selection
       
       
#### Interactive Matrix

##### Rationale
The visual centerpiece of the app, translating abstract project data into immediate spatial understanding. Users can see at a glance where their efforts should go based on strategic positioning rather than lists or urgency alone.

##### Visual Structure

**Quadrant Names:**
- Top-Left: "No-Brainer" (low cost, high benefit)
- Top-Right: "Breakthrough Zone" (high cost, high benefit)
- Bottom-Left: "Side-Quest" (low cost, low benefit)
- Bottom-Right: "Trap-Zone" (high cost, low benefit)

##### Interaction Patterns

**Visual States:**
- Active projects appear at full visibility
- Inactive projects appear dimmed
- Projects with deadlines show pulse (if due date is <3)
- Priority level affects color intensity 
- Categories have distinct shapes (discovered through use)

**Hover Behavior:**
When hovering over a project, see:
- Project title
- Due date if set
- Quick actions appear

**Click Actions:**
- Edit project details
- Mark as completed (triggers accuracy check)
- Set as Boss Battle
- Toggle active/inactive status

##### Business Logic

**Position Calculation:**
1. Take cost and benefit scores (1-10)
2. Map to canvas coordinates (with padding from edges)
3. Handle overlapping projects with offset algorithm
4. Apply visual states based on status and priority

**Animation Triggers:**
- New project: Appears with neo-brutalist animation
- Completion: Quick accuracy check then relevant neo-brutalist animation
- Deadline approaching: Graduated pulsing (see Visual States)
- Status change: Smooth opacity transition

**Completion Flow:**
When marking a project complete:
1. Simple popup: "Was the effort estimate accurate?"
   - "Spot on" âœ“ (DB: 'accurate')
   - "Easier than expected" â†“ (DB: 'easier')
   - "Harder than expected" â†‘ (DB: 'harder')
2. Record both original confidence and actual accuracy
3. Project disappears with celebration
4. XP calculation (Cost Ã— Benefit Ã— 10) Ã— 2 if Boss Battle
5. Check "The Estimator" achievement: confidence = 'high' AND accuracy = 'accurate'

### Phase 3: "Focus" Painting (Page 2)

#### Rationale
To provide a dedicated, minimalist environment for deep work and execution. Once a strategic decision has been made on the Map, this page facilitates focused action on those projects, shielding the user from other distractions within the app. He can still navigate to other pages for his work, and capture new ideas.
**Important note**: Projects and deep focus are two separate entities. the only link is that user chooses a project to work on. but you can finish a project for example without having done a single deep focus session on it. 

#### UX Flow

**Daily Flow (First Session):**
On first visit after midnight, optional commitment modal appears:
- "Want to commit?"
- Choose number of sessions (1-10)
- Can skip with "Not today"

**Main page and Session Setup:**
1. Select project from active projects list (single project)
2. Choose session duration (60, 90, or 120 minutes)
3. Click "Start Deep Focus"
4. Willpower check appears: "Willpower check"
   - ðŸ”¥ Piece Of Cake (High willpower)
   - â˜• Caffeinated (Medium willpower)
   - ðŸ¥± Don't Talk To Me (Low willpower)

**During Session:**
- Countdown timer displays
- Difficulty quote shows (based on willpower + duration with format "Difficulty Level : xxxx(placeholder) ")
- Project name visible (format : "Working on : xxxx " )
- Interrupt button (abandon session - no tracking, just ends)

**Session End:**
- **If Interrupted**: Minimal 1 XP, return to setup
- **If Completed**: 
  - completion sound
  - XP awarded based on difficulty
  - Mindset check: "Were you in the zone?"
    - "Shaolin" (DB: Excellent)
    - "Getting there" (DB: Good)
    - "What the heck is the zone ?" (DB: Challenging)
  - After mindset check, button that says user : "Another one bites the dust. Reward yourself. Take a break. Come back."
  - Returns to setup for next session with updated XP and sessions count of the day. (format : " Number of sessions completed today : xxxx " compared to target)

#### Business Logic

**Session Start:**
1. Validate active projects exist (empty state if none)
2. Calculate difficulty multiplier (willpower + duration)
3. Start countdown timer
4. Lock in session parameters
5. Begin tracking elapsed time

**During Session:**
1. Countdown decrements each second
2. user can switch to another tab, or app without countdown to stop.

**Session Completion:**
1. Stop timer
2. Calculate XP (base + difficulty multiplier + session decay)
3. Log session data (duration, project, willpower, completion status)
4. Check daily objective progress
5. Trigger achievements (first session, streak, etc.)
6. Update daily session count

#### Data Captured

**Session Data (DB fields):**
- project_id: integer (single project)
- duration: integer (60, 90, or 120)
- willpower: enum ('high', 'medium', 'low')
- completed: boolean
- mindset: enum ('excellent', 'good', 'challenging') - null if not completed
- started_at: timestamp
- date: date (for daily aggregation)

**Daily Commitment (DB fields):**
- date: date
- target_sessions: integer (1-10)
- completed_sessions: integer

#### Component Breakdown

**FocusPage** - Main container
- Manages session state
- Handles daily objective

**SessionSetup** - Pre-session configuration
- Project selector
- Duration picker
- Willpower check

**SessionTimer** - Active session view
- Countdown display
- Difficulty quote
- Interrupt handling

**SessionComplete** - Post-session flow
- Mindset check
- Break timer option
- Session summary 

#### Difficulty & XP System
**Difficulty Quotes Matrix:**
Based on willpower + duration combination, display during session:
- "I'm Too Young to Die" (High willpower + 60min)
- "Hey, Not Too Rough" (Medium willpower + 60min)
- "Bring It On" (High willpower + 90min)
- "Come Get Some" (Medium willpower + 90min)
- "Damn I'm Good" (Low willpower + 60min)
- "Crunch Time" (High willpower + 120min)
- "Balls of Steel" âšªâšª (Medium willpower + 120min)
- "Nightmare Deadline" (Low willpower + 90min)
- "Hail to the King" ðŸ‘‘ (Low willpower + 120min)

**XP Calculation:**
- **Base XP**: 10 points (participation reward)
- **Duration bonus**: actual_minutes / 10
- **Mindset bonus**: Shaolin +10, Getting there +5, What the heck is the Zone? +2
- **Difficulty multiplier** (from matrix above):
  - Easy combos: 0.5x-1x
  - Medium combos: 1.5x-2.5x
  - Hard combos: 3x-4x
- **Interrupted**: Fixed 1 XP (minimal reward)
- **Project Completion**: (Cost Ã— Benefit Ã— 10) Ã— 2 if Boss Battle
- **XP Storage**: Track weekly totals and best week ever for records 
 

### Phase 4: "Analytics" Painting (Page 3)

#### Rationale
To provide analytics, visual progress, achievements through minimal, focused data visualization. This page celebrates deep focus discipline separately from project output, showing patterns and progress. Users see their deep work consistency at a glance and understand their strategic project distribution.

#### UX Flow

**Page Entry:**
User navigates to Analytics via the navigation grid. The page loads instantly with current data.

**Visual Hierarchy:**
1. **Hero Stats** (top): Today's and this week's deep focus sessions
2. **Personal Records** (prominent): Records to beat for motivation
3. **14-Day Heatmap** : Deep focus consistency visualization
4. **Projects achieved** : Projects achieved this week (list with detailed datas - when added, completed, quadrant, ...)  
5. **Achievement Gallery** 

#### Business Logic

**Data Loading:**
1. Fetch today's deep focus sessions
2. Calculate current week totals (Monday-Sunday)
3. Fetch last 14 days for heatmap
4. Load personal records from all-time data
5. Check achievement conditions

**Calculations:**
- **Deep Focus Points**: 60 min = 1.0, 90 min = 1.5, 120 min = 2.0
- **Heatmap Colors**: Map total daily points to 5 intensity levels
- **Best Week XP**: Track highest weekly XP ever achieved

**Achievement Checking:**
Check conditions based on:
- Session difficulty levels completed
- Mindset ratings after sessions (DB: Excellent/Good/Challenging)
- Total hours and session lengths
- Weekly patterns

**Week Streak Calculation:**
- Week qualifies if â‰¥1 deep focus session completed
- Track consecutive qualifying weeks
- Reset to 0 if week has 0 sessions
- "Dedicated" achievement: 4 consecutive weeks

**Weekly Reset:**
- XP resets Monday 00:00
- Week streak evaluation happens Sunday night
- Other metrics continue accumulating
- Best Week XP persists as record

#### Data Captured

This page only reads existing data from:

**XP Events Table (DB fields):**
- type: enum ('session', 'project')
- source_id: integer (references session.id or project.id)
- amount: integer
- created_at: timestamp
- week_start: date (Monday of the week)

**Week Streaks Table (DB fields):**
- week_start: date (Monday)
- has_session: boolean (true if â‰¥1 session that week)

**Achievements Table (DB fields):**
- achievement_name: text
- unlocked_at: timestamp

No new data created on this page - only reads and displays.

#### Component Breakdown

**AnalyticsPage** - Main container
- Coordinates all data fetching
- Manages date calculations

**HeroStats** - Top section
- Today's sessions with durations
- Week totals and best day

**PersonalRecords** - Motivation bar
- Best day, hardest difficulty
- Longest session, best XP week

**DeepFocusHeatmap** - 14-day grid
- Color-coded by points
- Shows numeric value per day

**ProjectAchieved** - Projects achieved this week
- List of projects with detailed datas - when added, completed, quadrant, ...

**AchievementGallery** - Badge display
- 10 total achievements
- Locked shows only name of the badge (explanation when earned )

#### Analytics Details

**Hero Section Display:**
```
TODAY'S DEEP FOCUS                   THIS WEEK'S DEEP FOCUS
2 sessions (2.5 hours)               7 sessions (10.5 hours)
[60 min] [90 min]                    Best Day: Tuesday (3 sessions)

                    âš¡ 2,450 XP
```

**Personal Records:**
```
RECORDS TO BEAT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Best Day: 4 deep sessions (5 hours) - Aug 12
Hardest Difficulty: "Hail to the King" ðŸ‘‘ - Jul 28  
Best days streak: xx (format : "number of day in a row you did at least 1 deep focus session : xxxx " )
# days commitment nailed: xx (format : "Number of days you nailed your commitment : xxxx " )
Best Week XP: 4,280 XP - Week of Jul 15
```

**14-Day Deep Focus Heatmap:** (not prominemt)
- Points system: 60 min = 1.0, 90 min = 1.5, 120 min = 2.0
- Color gradient from white (0) to darkest (5+ points)
- Shows numeric value under each day
- Last 14 days including today

**Projects achieved this week:**
```
PROJECTS COMPLETED THIS WEEK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Project A - Aug 12 with detailed datas - when added, completed, quadrant, ...
Project B - Jul 28 with detailed datas - when added, completed, quadrant, ...
Project C - Jul 15 with detailed datas - when added, completed, quadrant, ...
```

**Project Graveyard:** 
```
ðŸª¦ Abandoned Projects (3)
    â†‘ hover shows: "Project A - Aug 12 | Project B - Jul 28 | Project C - Jul 15"
```
Only shows if abandoned projects exist.

**Achievement System (10 Total - Same as Phase 2):** (format : only the name of the achievement is displayed, explanation when earned )
- "First Blood" - First project completed
- "Double Digits" - 10 projects completed
- "Giant Slayer" - Complete first 10/10 cost project
- "Dark Souls Mode" - Complete Boss Battle marked "Total Guess"
- "Frame Perfect" - Complete project exactly on deadline
- "Centurion" - 100 total deep focus hours
- "Dedicated" - 4-week focus streak
- "The Grind" - Complete 10 hour focus day
- "The Estimator" - 5 accurate estimates (confidence matches outcome)
- "No-Brainer King" - 10 projects from No-Brainer quadrant

### Phase 5: "Prime" painting (Page 4)

#### Rationale
To establish the user's foundational principles and identity. This page is the "why" behind all actions. It's a space for introspection and defining the high-level operating system for oneself. for now, it will template a humoristic human system prompt. (see annex - human-system-prompt.md)

#### UX Flow

**Human System Prompt:**
- The user views their saved prompt. They can click an "Edit" icon, which turns the display into a Textarea. 
- After making changes, they click a "Save" icon.
- Shows template initially (see annex - human-system-prompt.md): Defines core values and long-term vision.

**Yellow Duck Friend** (inspired by CS50 rubber duck debugging):
- Daily Journal: The user sees a Textarea pre-labeled with today's date
- They can type their thoughts and click "Save" to persist the entry for the day
- Previous entries shown in a list below the textarea.
- we'll name it "Duck-E" (in reference to Wall-E, as it will evolve later with AI assistance)

#### Business Logic

**System Prompt:**
1. Load saved text or show template
2. Edit mode on click
3. Save on button click
4. Store in database

**Daily Journal:**
1. One entry per day
2. Past entries read-only
3. Auto-date each entry

#### Data Captured

**Prime Settings (DB fields):**
- system_prompt: text
- updated_at: timestamp

**Journal Entries (DB fields):**
- date: date (unique)
- entry: text
- created_at: timestamp

#### Component Breakdown

**PrimePage** - Main container
- **SystemPrompt** - Editable prompt section
- **DailyJournal** - "Duck-E" Journal entry section 

### Phase 6: First-Time User Onboarding

#### Rationale
A polished, minimal onboarding that teaches the core loop. Users learn by seeing real UI elements highlighted.
Welcome â†’ Three steps â†’ Done. Everything else is discovered through exploration.

#### UX Flow

**Detection:**
Check localStorage for `hasCompletedOnboarding` flag. If not present, trigger onboarding on first login.

**Step 0: Welcome Dialog (before spotlight tour)**
- Full-screen modal with clean design
- Content (rough):
  ```
  Hey There. Welcome.
  
  Your name?
  [Name input field]
  
  [Start Tour â†’]
  ```
- Name saved to user profile for personalization
- Cannot skip - need name to proceed

**Step 1: Capture Principle (5 seconds)**
- After welcome, screen dims except for Capture Bar (spotlight effect)
- Dialog appears pointing to Capture Bar:
  ```
  Your mind is for having ideas, not holding them.
  
  When a thought strikes, capture it here instantly.
  No categories, no priority, no friction.
  Just capture. Organize later.
  
  During triage, we'll route each item where it belongs -
  your calendar, project tools, todo apps, or tracked here.
  
  We're the meta-layer above your existing tools.
  
  [I see â†’]
  ```

**Step 2: Tactical Map Introduction (5 seconds)**
- Spotlight shifts to the scatter plot area
- Sample projects appear with subtle animation
- Dialog explains:
  ```
  Every project has three dimensions:
  How much it costs you. What it gives back. How urgent it is.
  
  This map plots cost against benefit. 
  Color shows priority.
  
  You can see your entire landscape at once -
  the quick wins, the big bets, the time sinks.
  
  It's just a different way to see your work.
  
  [Got it â†’]
  ```

**Step 3: Deep Focus Purpose (5 seconds)**
- Auto-navigate to Focus painting
- Spotlight on session setup area
- dialog:
  ```
  Deep work deserves to be measured.
  
  When you're about to enter a focused session,
  log it here. Track your willpower that day.
  See how difficulty affects your output.
  
  Over time, you'll discover your patterns -
  when you're strongest, what durations work,
  which projects flow and which fight back.
  
  It's just data about your deep work.
  
  [Let's go â†’]
  ```
- Returns to Tactical Map after completion
- Sets `hasCompletedOnboarding` in localStorage

**Step 4** : Start adding projects
- Propose user to add a few project he is working on and highlight "add a project"
- Dialog:
  ```
  The map starts empty. Your map.
  
  Consider adding a few current projects -
  the ones taking up mental space right now.
  
  Each gets a cost score (how much effort)
  and benefit score (what it unlocks).
  
  The patterns emerge once you have a few plotted.
  
  [Add first project â†’]
  ```

#### Business Logic

**Onboarding Flow State Machine:**
1. Check `onboarding_completed` in user_profiles table
2. If false or null, trigger onboarding sequence
3. Track current step in component state (0-4)
4. Progression only moves forward (no back button)
5. Cannot skip steps except via escape key (sets completed flag)

**Step Transitions:**
- Step 0 (Welcome): Validate name input â†’ save to user_profiles.display_name
- Step 1 (Capture): Timer-based auto-advance after 5 seconds or click
- Step 2 (Map): Timer-based auto-advance after 5 seconds or click  
- Step 3 (Focus): Timer-based auto-advance after 5 seconds or click
- Step 4 (Projects): Opens ProjectCreator modal â†’ on close, set onboarding_completed = true

**Escape Hatch:**
- ESC key at any point sets onboarding_completed = true and exits
- Ensures power users can skip if returning to app

#### Spotlight Implementation:

**Library Options:**

**Option A: Driver.js (Recommended)**
- 4KB gzipped, zero dependencies
- TypeScript native with full type definitions
- Simple API perfect for our 4-step flow
- Neo-brutalism ready with CSS customization

```typescript
// Implementation sketch
import { driver } from 'driver.js';

const tour = driver({
  animate: false, // Neo-brutalism: no smooth transitions
  overlayColor: 'rgba(0, 0, 0, 0.85)',
  popoverClass: 'neo-brutal-popover',
  steps: [
    { element: '.capture-bar', popover: {...} },
    { element: '.tactical-map', popover: {...} },
    // etc.
  ]
});
```

**Option B: Shepherd.js (Alternative)**
- More robust, 15KB gzipped
- Better for complex conditional flows
- TypeScript support via @types/shepherd.js
- Tethering system keeps tooltips perfectly positioned

**Neo-Brutalism Styling (works with both):**
```css
.driver-popover, .shepherd-element {
  border: 3px solid #000 !important;
  border-radius: 0 !important;
  box-shadow: 8px 8px 0 #000 !important;
  background: #FAFAFA !important;
  font-family: 'Space Mono', monospace;
}
```

**Decision: Use Driver.js** - Aligns with our minimalist philosophy, 
smaller footprint, and simpler implementation for our straightforward tour.

#### Data Captured

**None** - No analytics for onboarding. Keep it simple.
Only store user's name in their profile (using user_profiles table):
- `display_name` - Collected during onboarding
- `onboarding_completed` - Set to true after tour completion

#### Component Breakdown

**OnboardingManager** - Root orchestrator
- Checks user_profiles.onboarding_completed
- Manages step progression (0-4)
- Handles ESC key listener
- Coordinates with Driver.js

**WelcomeModal** - Step 0
- Name input with validation
- Saves to user_profiles table
- Cannot be skipped
- Transitions to tour on submit

**OnboardingTour** - Steps 1-3
- Wraps Driver.js configuration
- Defines step content and targets
- Handles auto-advance timers
- Custom neo-brutalism styling

**ProjectOnboarding** - Step 4
- Opens ProjectCreator in onboarding mode
- Pre-fills example values
- Sets completion flag on first project save
- Shows sample projects on map

#### Polish Details:

**Critical First Impression Elements:**

**Timing Perfection:**
- Welcome modal: Instant load, no delay
- Step transitions: 200ms fade, no bounce
- Auto-advance: 5 seconds reading time
- Total experience: Under 30 seconds

**Visual Consistency:**
- Neo-brutalism throughout: Bold borders, no radius
- Consistent shadows: 8px offset, pure black
- Typography: Space Mono for all onboarding text
- Colors: High contrast, accessibility compliant

**Micro-interactions:**
- Keyboard navigation: Tab through all elements
- Button states: Clear hover/active feedback
- Input validation: Instant, inline, no jarring errors
- Progress indication: Subtle step counter (1/4, 2/4...)

**Edge Cases Handled:**
- Browser back button: Doesn't break flow
- Page refresh: Resumes from current step
- Network failure: Graceful degradation
- Mobile viewport: Responsive positioning

**Quality Markers:**
- Zero flicker or layout shift
- Smooth spotlight transitions
- Text appears crisp at all zoom levels
- ESC key response < 50ms

**The "Wow" Factor:**
- Sample projects animate onto map elegantly
- Capture bar pulses subtly when highlighted
- Final step celebrates without being cheesy
- Overall: Feels inevitable, not instructional


## ANNEX Technical Details 

### SEO Architecture & URL Strategy

**Route Structure (Set in Stone Now):**
```
/ (marketing)
  /                    â†’ Landing page (SSG)
  /pricing             â†’ Pricing page (SSG)
  /blog                â†’ Blog index (SSG)
  /blog/[slug]         â†’ Blog posts (SSG/ISR)
  /features            â†’ Feature overview (SSG)
  /docs                â†’ Documentation (SSG)
  
/app (authenticated - no SEO)
  /app/map             â†’ Tactical Map (CSR)
  /app/focus           â†’ Deep Focus (CSR)
  /app/analytics       â†’ Analytics (CSR)
  /app/prime           â†’ Prime (CSR)
```

**Rendering Strategy:**
- **Static (SSG)**: Marketing pages, blog posts - Fast, SEO-optimized
- **Client-Side (CSR)**: App pages behind auth - No SEO needed
- **Incremental (ISR)**: Blog posts can regenerate when updated

**Database Schema for SEO (Add These Fields Now):**
```sql
-- For any future public content (blog posts, docs)
ALTER TABLE future_content_table ADD COLUMN
  slug TEXT UNIQUE NOT NULL,
  meta_title TEXT,
  meta_description TEXT,
  og_image_url TEXT,
  canonical_url TEXT,
  published_at TIMESTAMP,
  updated_at TIMESTAMP;
```

**URL Rules (Never Break These):**
- Clean slugs from day 1: `/features/tactical-map` not `/feature?id=123`
- Consistent trailing slash policy: Never use them
- Lowercase URLs only: `/app/map` not `/app/Map`
- Hyphens for word separation: `deep-focus` not `deep_focus`

**Evolution Path (Easy to Add Later):**
- Meta descriptions and Open Graph tags
- Schema.org structured data
- XML sitemap generation
- robots.txt refinement
- Performance optimizations (lazy loading, CDN)

### Recommended Tech Stack 

**Frontend:**
- Next.js 15 (App Router) - With clear `/app` vs `/(marketing)` separation
- React 19
- TypeScript 5
- @tanstack/react-query v5 (server state management)
- @supabase/supabase-js v2 (database client)
- Tailwind CSS v4
- shadcn/ui v4 components with Neobrutalism styling
- lucide-react (icons - clean, consistent, lightweight)
- Framer Motion v11 (animations)
- Recharts v2 (data visualizations)

**Backend & Database:**
- Supabase (PostgreSQL + Auth + Realtime)
- Database tables as defined in spec (16 tables)
- Row Level Security for future multi-user

**Key shadcn/ui Components for MVP:**
- `dialog` - Modals (ProjectCreator, Triage)
- `button` - All actions
- `card` - Project nodes on map
- `tabs` - Navigation could use this
- `progress` - Timer/countdown in Focus
- `badge` - Achievements
- `textarea` - Capture bar, journal
- `select` - Dropdowns in ProjectCreator
- `slider` - Cost/Benefit scoring
- `toast` - Notifications (undo, etc.)
- `chart` - Analytics visualizations

**Deployment:**
- Vercel (seamless with Next.js)
- Environment variables for Supabase keys

**Styling Approach:**
- Neobrutalism theme on top of shadcn/ui
- Bold borders, offset shadows
- High contrast colors 
- Reference: neobrutalism.dev
- smart animations

### Technical Decisions & Rationale

#### Core Architecture Decisions

**Why These Tools for MVP:**

1. **TanStack Query v5** âœ… (Use from Day 1)
   - **Why**: Handles all async complexity (loading, error, caching, refetching)
   - **When to use**: Every Supabase query from the start
   - **What it replaces**: 50+ lines of useState + useEffect per data fetch
   - **Example**: `useProjects()` hook manages fetch, cache, and refetch in 5 lines

2. **React useState + Context** âœ… (Use from Day 1)
   - **Why**: Built-in, zero dependencies, perfectly adequate for MVP scope
   - **When to use**: All UI state (modals, form inputs, hover states)
   - **Context for**: Auth state only (maybe theme later)
   - **Not needed for**: Props work fine for 1-2 level passing

3. **TypeScript** âœ… (Use from Day 1)
   - **Why**: Catches errors at compile time, excellent IDE support
   - **How strict**: Strict mode ON, but allow `any` for rapid prototyping
   - **Focus on**: Type your Supabase responses and component props

**Tools We're NOT Using (and Why):**

1. **Zod** âŒ (Add Month 2-3)
   - **Why skip**: Database constraints already validate data
   - **When to add**: When you have 10+ users breaking things
   - **Future use case**: API endpoints, CSV imports, webhook data
   - **Cost to add later**: 2 hours (just wrap existing queries)

2. **Zustand** âŒ (Probably Never)
   - **Why skip**: 4 paintings, ~20 components total - useState is enough
   - **When to add**: If timer state needs sharing across 4+ components
   - **What indicates need**: Passing same props through 3+ levels
   - **Cost to add later**: 4 hours (straightforward migration)

3. **Redux** âŒ (Never)
   - **Why skip**: Massive overkill for solo dev project
   - **Alternative**: If you need complex state, use Zustand instead
   - **Only consider if**: Team grows to 5+ developers

**Decision Framework:**

```typescript
// Use this mental model for any tool decision:
function shouldAddTool(tool: Tool): boolean {
  if (tool.setupTime > 30_minutes && !tool.solvesImmediateProblem) {
    return false; // Not for MVP
  }
  
  if (existingSolution.works && refactorCost < 4_hours) {
    return false; // Add when actually needed
  }
  
  return true;
}
```

**Real-World Signals to Add Tools:**

```typescript
// When to add Zod (Month 2-3):
if (userReports.includes("Project cost shows as '[object Object]'") ||
    apiEndpoints.count > 0 ||
    webhooks.exist ||
    csvImports.planned) {
  addZod(); // Now you need runtime validation
}

// When to add Zustand (Probably never for this app):
if (propsChain.depth >= 4 ||
    components.sharingState.count >= 5 ||
    performance.rerenders > 100) {
  considerZustand(); // But honestly, Context might still work
}

// When to add Sentry (Week 2 of beta):
if (users.count >= 10 &&
    discordMessages.include("It's broken") &&
    !you.knowWhy) {
  addSentry(); // You need visibility
}
```

### State Management Architecture

**Server State (TanStack Query v5):**
- All Supabase data fetching and caching
- 5-minute cache time for most data
- Optimistic updates for XP and project completion
- Query invalidation on mutations
- Key hooks structure:
  - `useProjects()` - Project CRUD and filtering
  - `useCaptures()` - Capture queue management
  - `useSessions()` - Focus session history
  - `useAchievements()` - Achievement checking
  - `useWeeklyXP()` - XP calculations and animations

**UI State (React useState + Context):**
- Modal open/close states (ProjectCreator, Triage, etc.)
- Focus timer countdown (local to Focus painting)
- Form inputs and validation
- Hover states on scatter plot
- Animation values for XP counter
- Current painting/page navigation

**Data Flow Patterns:**
- **Optimistic Updates**: Project completion, capture submission
- **Pessimistic Updates**: Focus session start/end, achievements unlock
- **Local-First**: Timer state, form drafts
- **Server-First**: Projects, analytics data

**Deferred for Post-MVP:**
- Zustand (only if prop drilling becomes painful)
- WebSocket subscriptions (except focus timer)
- Complex caching strategies
- Undo/redo functionality
- Zod validation (when external data sources added)

### Authentication Strategy

**MVP Approach - Real Auth with Test User :**
Build with real Supabase Auth from day 1, using a test account for development:

```typescript
// utils/auth.ts - Real auth from the start
export const getCurrentUser = async () => {
  const { data: { user } } = await supabase.auth.getUser()
  return user // Real user object
}

// middleware.ts - Protect all routes except login
export async function middleware(request: NextRequest) {
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user && !request.url.includes('/login')) {
    return NextResponse.redirect(new URL('/login', request.url))
  }
}
```

**Minimal Login Page (MVP):**
- Simple email/password form
- No signup flow (create users via Supabase dashboard)
- No password reset (handle manually for beta)
- Pre-populated with test credentials in dev mode


**Database Structure with Real Auth:**
```sql
-- All tables reference real auth.users
CREATE TABLE projects (
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  -- other fields...
);

-- Enable RLS from day 1
ALTER TABLE projects ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own data" ON projects 
  USING (auth.uid() = user_id);
```

**Development Workflow:**
1. Create test user in Supabase: test@productionrebellion.com
2. Auto-login in development environment
3. Create additional users via Supabase dashboard as needed
4. Beta testers get real accounts (no signup UI needed)

**Benefits of Real Auth from Start:**
- No refactoring needed later 
- RLS policies work properly from day 1
- Can test with multiple users immediately
- Beta testers get isolated data
- Only adds 2-3 hours vs fake auth

### Errors handling philosophy - Features not yet implemented - limitations of the app.
 All errors should follow the solo-dev humor pattern:
  - Acknowledge the limitation
  - Explain why it exists (time/resource trade-off)
  - Offer a workaround
  - Keep it light and self-aware



**Database Schema:**
14 tables as specified throughout phases (updated with critical missing elements):

```sql
-- 1. captures table - Stores all captured thoughts pending triage
CREATE TABLE captures (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  content TEXT NOT NULL, -- Original user input
  status TEXT DEFAULT 'pending', -- 'pending' or 'triaged'
  source_painting TEXT, -- which page user was on when capturing
  
  -- JSONB field for AI enhancements and future features
  enrichments JSONB DEFAULT '{}', -- Can store: rephrased text, categories, entities, suggestions
  -- Example enrichments structure:
  -- {
  --   "ai_v1": {
  --     "rephrased": "Better structured version",
  --     "category": "work",
  --     "confidence": 0.92,
  --     "extracted_entities": ["person", "project", "deadline"],
  --     "suggested_cost": 5,
  --     "suggested_benefit": 8
  --   }
  -- }
  
  created_at TIMESTAMP DEFAULT NOW(),
  triaged_at TIMESTAMP -- When the item was triaged (helps track queue time)
);

-- 2. projects table - Main project tracking
CREATE TABLE projects (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  cost INTEGER CHECK (cost >= 1 AND cost <= 10),
  benefit INTEGER CHECK (benefit >= 1 AND benefit <= 10),
  priority TEXT CHECK (priority IN ('must', 'should', 'nice')),
  category TEXT CHECK (category IN ('work', 'learn', 'build', 'manage')),
  status TEXT CHECK (status IN ('active', 'inactive', 'completed', 'abandoned')),
  is_boss_battle BOOLEAN DEFAULT FALSE,
  was_boss_battle BOOLEAN DEFAULT FALSE, -- snapshot at completion
  boss_battle_locked_at TIMESTAMP, -- when Boss Battle was locked by starting a focus session
  boss_battle_session_id INTEGER, -- which session locked the Boss Battle (FK added after sessions table)
  confidence TEXT CHECK (confidence IN ('high', 'medium', 'low')),
  accuracy TEXT CHECK (accuracy IN ('accurate', 'easier', 'harder')), -- null until completed
  due_date DATE,
  
  -- JSONB for extensible project metadata
  metadata JSONB DEFAULT '{}', -- Future: AI insights, related projects, resource links, notes
  -- Example metadata structure:
  -- {
  --   "ai_insights": {
  --     "complexity_score": 7.5,
  --     "similar_past_projects": [45, 67],
  --     "recommended_approach": "Break into 3 phases",
  --     "risk_factors": ["scope_creep", "dependencies"]
  --   },
  --   "resources": ["notion://page-id", "figma://file-id"],
  --   "collaborators": ["john@example.com"],
  --   "custom_fields": {}
  -- }
  
  created_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,
  
  -- Prevent coordinate collisions (MVP constraint - will add smart positioning in v2)
  CONSTRAINT unique_project_coordinates 
  UNIQUE (user_id, cost, benefit) 
  WHERE status IN ('active', 'inactive')
);

-- 3. difficulty_levels table - Lookup table for session difficulties
CREATE TABLE difficulty_levels (
  id SERIAL PRIMARY KEY,
  level INTEGER UNIQUE NOT NULL CHECK (level >= 1 AND level <= 9), -- 1=easiest, 9=hardest
  quote TEXT UNIQUE NOT NULL, -- "I'm Too Young to Die", "Hail to the King", etc.
  willpower TEXT NOT NULL CHECK (willpower IN ('high', 'medium', 'low')),
  duration INTEGER NOT NULL CHECK (duration IN (60, 90, 120)),
  multiplier DECIMAL(3,1) NOT NULL CHECK (multiplier >= 0.5 AND multiplier <= 4.0),
  emoji TEXT -- Optional: âšªâšª, ðŸ‘‘, etc.
);

-- Seed data for difficulty levels (run after table creation)
INSERT INTO difficulty_levels (level, quote, willpower, duration, multiplier, emoji) VALUES
(1, 'I''m Too Young to Die', 'high', 60, 0.5, NULL),
(2, 'Hey, Not Too Rough', 'medium', 60, 1.0, NULL),
(3, 'Damn I''m Good', 'low', 60, 1.5, NULL),
(4, 'Bring It On', 'high', 90, 1.5, NULL),
(5, 'Come Get Some', 'medium', 90, 2.0, NULL),
(6, 'Nightmare Deadline', 'low', 90, 2.5, NULL),
(7, 'Crunch Time', 'high', 120, 2.5, NULL),
(8, 'Balls of Steel', 'medium', 120, 3.0, 'âšªâšª'),
(9, 'Hail to the King', 'low', 120, 4.0, 'ðŸ‘‘');

-- 4. sessions table - Deep focus session tracking
CREATE TABLE sessions (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  project_id INTEGER REFERENCES projects(id),
  duration INTEGER CHECK (duration IN (60, 90, 120)),
  willpower TEXT CHECK (willpower IN ('high', 'medium', 'low')),
  completed BOOLEAN DEFAULT FALSE,
  mindset TEXT CHECK (mindset IN ('excellent', 'good', 'challenging')), -- null if not completed
  difficulty_level_id INTEGER REFERENCES difficulty_levels(id), -- Reference to difficulty lookup table
  xp_earned INTEGER, -- Total XP earned from this session
  xp_breakdown JSONB, -- {"base": 10, "duration_bonus": 9, "mindset_bonus": 10, "multiplier": 3.0}
  started_at TIMESTAMP DEFAULT NOW(),
  date DATE DEFAULT CURRENT_DATE
);

-- Add foreign key constraint after sessions table is created
ALTER TABLE projects 
ADD CONSTRAINT fk_boss_battle_session 
FOREIGN KEY (boss_battle_session_id) 
REFERENCES sessions(id) ON DELETE SET NULL;

-- 5. parking_lot table - Someday/maybe items from triage
CREATE TABLE parking_lot (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  content TEXT NOT NULL,
  source_capture_id INTEGER REFERENCES captures(id),
  created_at TIMESTAMP DEFAULT NOW()
);

-- 6. daily_commitments table - Daily focus objectives
CREATE TABLE daily_commitments (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  date DATE NOT NULL,
  target_sessions INTEGER CHECK (target_sessions >= 1 AND target_sessions <= 10),
  completed_sessions INTEGER DEFAULT 0,
  UNIQUE(user_id, date)
);

-- 7. xp_events table - XP earning events
CREATE TABLE xp_events (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  type TEXT CHECK (type IN ('session', 'project')),
  source_id INTEGER, -- references session.id or project.id
  amount INTEGER NOT NULL,
  week_start DATE NOT NULL, -- Monday of the week
  created_at TIMESTAMP DEFAULT NOW()
);

-- 8. week_streaks table - Weekly consistency tracking
CREATE TABLE week_streaks (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  week_start DATE NOT NULL, -- Monday
  has_session BOOLEAN DEFAULT FALSE, -- true if â‰¥1 session that week
  UNIQUE(user_id, week_start)
);

-- 9. achievements table - Unlocked achievements
CREATE TABLE achievements (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  achievement_name TEXT NOT NULL,
  unlocked_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, achievement_name)
);

-- 10. prime_settings table - User's system prompt
CREATE TABLE prime_settings (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL UNIQUE,
  system_prompt TEXT,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 11. journal_entries table - Daily journal/reflection
CREATE TABLE journal_entries (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  date DATE NOT NULL,
  entry TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, date)
);

-- 12. triage_decisions table - Track triage workflow decisions
CREATE TABLE triage_decisions (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  capture_id INTEGER REFERENCES captures(id),
  decision TEXT CHECK (decision IN ('project', 'parking', 'quick', 'routing', 'delete')),
  time_to_decision INTEGER, -- milliseconds
  created_at TIMESTAMP DEFAULT NOW()
);

-- 13. personal_records table - Store user's personal best records
CREATE TABLE personal_records (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL UNIQUE,
  
  -- Best day tracking
  best_day_sessions INTEGER,
  best_day_hours DECIMAL(3,1),
  best_day_date DATE,
  
  -- Hardest difficulty tracking  
  hardest_difficulty_quote TEXT,  -- "Hail to the King"
  hardest_difficulty_date DATE,
  
  -- Longest session tracking
  longest_session_minutes INTEGER,
  longest_session_date DATE,
  
  -- Best week XP tracking
  best_week_xp INTEGER,
  best_week_start DATE,
  
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 14. user_profiles table - Extended user profile information
CREATE TABLE user_profiles (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL UNIQUE,
  display_name TEXT, -- Collected during onboarding
  onboarding_completed BOOLEAN DEFAULT FALSE,
  
  -- Access management (14-day full access, then support request)
  has_lifetime_access BOOLEAN DEFAULT FALSE,
  support_tier TEXT CHECK (support_tier IN ('standard', 'student')), -- Which tier they chose
  supported_at TIMESTAMP, -- When they became a supporter
  
  created_at TIMESTAMP DEFAULT NOW()
);

-- 15. purchases table - One-time payment tracking (legacy/optional)
-- Note: With BMC, payments are tracked in bmc_supporters table
-- This table can be used for future payment providers or direct Stripe integration
CREATE TABLE purchases (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) NOT NULL UNIQUE, -- One purchase per user
  
  -- Generic payment details (provider-agnostic)
  provider TEXT NOT NULL, -- 'bmc', 'stripe', 'gumroad', etc.
  transaction_id TEXT NOT NULL UNIQUE,
  
  -- Payment info
  amount DECIMAL(10,2) NOT NULL,
  currency TEXT DEFAULT 'USD',
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'completed', 'refunded')),
  
  -- Timestamps
  initiated_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,
  refunded_at TIMESTAMP
);

-- 16. bmc_supporters table - Track Buy Me a Coffee supporters
CREATE TABLE bmc_supporters (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) UNIQUE, -- One entry per user
  
  -- Supporter information
  supporter_email TEXT NOT NULL,
  supporter_name TEXT,
  support_tier TEXT CHECK (support_tier IN ('standard', 'student')),
  amount DECIMAL(10,2) NOT NULL,
  
  -- BMC webhook data
  bmc_transaction_id TEXT UNIQUE,
  message TEXT, -- Optional message from supporter
  
  -- Timestamps
  supported_at TIMESTAMP DEFAULT NOW()
);

-- Performance indexes for common queries
CREATE INDEX idx_projects_user_status ON projects(user_id, status);
CREATE INDEX idx_projects_boss_battle ON projects(user_id, is_boss_battle) WHERE is_boss_battle = TRUE;
CREATE INDEX idx_sessions_user_date ON sessions(user_id, date DESC);
CREATE INDEX idx_sessions_completed ON sessions(user_id, completed) WHERE completed = TRUE;
CREATE INDEX idx_xp_events_week ON xp_events(user_id, week_start DESC);
CREATE INDEX idx_captures_pending ON captures(user_id, status) WHERE status = 'pending';
CREATE INDEX idx_achievements_user ON achievements(user_id, achievement_name);
CREATE INDEX idx_personal_records_user ON personal_records(user_id);
CREATE INDEX idx_triage_decisions_capture ON triage_decisions(capture_id);

-- JSONB indexes for efficient querying of AI-enhanced data
CREATE INDEX idx_captures_enrichments ON captures USING GIN (enrichments);
CREATE INDEX idx_projects_metadata ON projects USING GIN (metadata);
-- Specific path indexes for frequently accessed JSONB fields (add as needed)
-- CREATE INDEX idx_captures_ai_category ON captures ((enrichments->'ai_v1'->>'category'));
-- CREATE INDEX idx_projects_complexity ON projects ((metadata->'ai_insights'->>'complexity_score'));

-- Row Level Security (RLS) Policies for payment protection
ALTER TABLE purchases ENABLE ROW LEVEL SECURITY;
ALTER TABLE bmc_supporters ENABLE ROW LEVEL SECURITY;

-- Users can only see their own purchase
CREATE POLICY "Users can view own purchase" ON purchases
  FOR SELECT USING (auth.uid() = user_id);

-- Only service role can insert/update purchases (via webhook)
CREATE POLICY "Service role manages purchases" ON purchases
  FOR ALL USING (auth.jwt()->>'role' = 'service_role');

-- BMC supporters table - users can see their own entry
CREATE POLICY "Users can view own support info" ON bmc_supporters
  FOR SELECT USING (auth.uid() = user_id);

-- Only service role can manage supporter records
CREATE POLICY "Service role manages supporters" ON bmc_supporters
  FOR ALL USING (auth.jwt()->>'role' = 'service_role');

-- Helper function to check if user has access (14-day period or lifetime)
CREATE OR REPLACE FUNCTION has_app_access(user_uuid UUID)
RETURNS BOOLEAN AS $$
DECLARE
  profile RECORD;
  days_since_signup INTEGER;
BEGIN
  SELECT 
    has_lifetime_access,
    DATE_PART('day', NOW() - created_at) as days_elapsed
  INTO profile
  FROM user_profiles 
  WHERE user_id = user_uuid;
  
  -- Has lifetime access OR still in 14-day period
  RETURN profile.has_lifetime_access = TRUE 
    OR COALESCE(profile.days_elapsed, 0) < 14;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Helper function to check access status
CREATE OR REPLACE FUNCTION get_access_status(user_uuid UUID)
RETURNS TABLE(
  has_access BOOLEAN,
  access_type TEXT, -- 'lifetime', 'exploring', 'needs_support'
  days_remaining INTEGER,
  support_tier TEXT
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    CASE 
      WHEN up.has_lifetime_access THEN TRUE
      WHEN DATE_PART('day', NOW() - up.created_at) < 14 THEN TRUE
      ELSE FALSE
    END as has_access,
    CASE
      WHEN up.has_lifetime_access THEN 'lifetime'::TEXT
      WHEN DATE_PART('day', NOW() - up.created_at) < 14 THEN 'exploring'::TEXT
      ELSE 'needs_support'::TEXT
    END as access_type,
    CASE 
      WHEN DATE_PART('day', NOW() - up.created_at) < 14
      THEN (14 - DATE_PART('day', NOW() - up.created_at))::INTEGER
      ELSE 0
    END as days_remaining,
    up.support_tier
  FROM user_profiles up
  WHERE up.user_id = user_uuid;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Database function to grant lifetime access (called by BMC webhook)
CREATE OR REPLACE FUNCTION grant_lifetime_access(
  user_email TEXT,
  amount DECIMAL,
  supporter_name TEXT DEFAULT NULL,
  support_tier TEXT DEFAULT 'standard'
)
RETURNS VOID AS $$
DECLARE
  target_user_id UUID;
BEGIN
  -- Find user by email
  SELECT id INTO target_user_id
  FROM auth.users
  WHERE email = user_email;
  
  IF target_user_id IS NULL THEN
    RAISE EXCEPTION 'User not found with email: %', user_email;
  END IF;
  
  -- Record BMC supporter information
  INSERT INTO bmc_supporters (
    user_id,
    supporter_email,
    supporter_name,
    support_tier,
    amount,
    supported_at
  ) VALUES (
    target_user_id,
    user_email,
    supporter_name,
    support_tier,
    amount,
    NOW()
  )
  ON CONFLICT (user_id) DO UPDATE
  SET 
    amount = EXCLUDED.amount,
    support_tier = EXCLUDED.support_tier,
    supported_at = NOW();
  
  -- Grant lifetime access and record tier
  UPDATE user_profiles
  SET 
    has_lifetime_access = TRUE,
    support_tier = grant_lifetime_access.support_tier,
    supported_at = NOW()
  WHERE user_id = target_user_id;
  
  -- Log the grant for audit
  RAISE NOTICE 'Granted lifetime access to user % (% tier: $%)', user_email, support_tier, amount;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Grant execute permission to service role only
GRANT EXECUTE ON FUNCTION grant_lifetime_access TO service_role;
REVOKE EXECUTE ON FUNCTION grant_lifetime_access FROM public, anon, authenticated;

-- Coordinate collision detection functions
CREATE OR REPLACE FUNCTION check_coordinate_availability(
  p_user_id UUID,
  p_cost INTEGER,
  p_benefit INTEGER,
  p_exclude_id INTEGER DEFAULT NULL
) RETURNS BOOLEAN AS $$
BEGIN
  RETURN NOT EXISTS (
    SELECT 1 
    FROM projects 
    WHERE user_id = p_user_id 
      AND cost = p_cost 
      AND benefit = p_benefit 
      AND status IN ('active', 'inactive')
      AND (p_exclude_id IS NULL OR id != p_exclude_id)
  );
END;
$$ LANGUAGE plpgsql;

-- Suggest nearby available coordinates when collision detected
CREATE OR REPLACE FUNCTION suggest_nearby_coordinates(
  p_user_id UUID,
  p_cost INTEGER,
  p_benefit INTEGER
) RETURNS TABLE(cost INTEGER, benefit INTEGER) AS $$
BEGIN
  RETURN QUERY
  WITH potential_coords AS (
    SELECT 
      GREATEST(1, LEAST(10, p_cost + dx)) as new_cost,
      GREATEST(1, LEAST(10, p_benefit + dy)) as new_benefit
    FROM (
      VALUES 
      (0, 1), (1, 0), (0, -1), (-1, 0),  -- Adjacent
      (1, 1), (1, -1), (-1, 1), (-1, -1), -- Diagonals
      (0, 2), (2, 0), (0, -2), (-2, 0)    -- 2 steps away
    ) AS offsets(dx, dy)
  )
  SELECT DISTINCT pc.new_cost, pc.new_benefit
  FROM potential_coords pc
  WHERE NOT EXISTS (
    SELECT 1 
    FROM projects p
    WHERE p.user_id = p_user_id 
      AND p.cost = pc.new_cost 
      AND p.benefit = pc.new_benefit 
      AND p.status IN ('active', 'inactive')
  )
  AND (pc.new_cost != p_cost OR pc.new_benefit != p_benefit)
  LIMIT 3;
END;
$$ LANGUAGE plpgsql;

-- Business rule enforcement: Maximum 20 active projects per user
CREATE OR REPLACE FUNCTION check_active_project_limit()
RETURNS TRIGGER AS $$
BEGIN
  -- Only check when setting status to 'active'
  IF NEW.status = 'active' THEN
    -- Count existing active projects for this user (excluding current row if updating)
    IF (SELECT COUNT(*) 
        FROM projects 
        WHERE user_id = NEW.user_id 
        AND status = 'active'
        AND id != COALESCE(NEW.id, -1)) >= 20 THEN
      RAISE EXCEPTION 'Maximum 20 active projects allowed. Complete or abandon existing projects first.';
    END IF;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to enforce 20-project limit
CREATE TRIGGER enforce_project_limit
BEFORE INSERT OR UPDATE ON projects
FOR EACH ROW
EXECUTE FUNCTION check_active_project_limit();

-- Boss Battle locking when focus session starts
CREATE OR REPLACE FUNCTION lock_boss_battle_on_session_start()
RETURNS TRIGGER AS $$
BEGIN
  -- Check if the project being worked on is a Boss Battle
  IF EXISTS (
    SELECT 1 FROM projects 
    WHERE id = NEW.project_id 
    AND is_boss_battle = TRUE
    AND boss_battle_locked_at IS NULL  -- Only lock if not already locked
  ) THEN
    -- Lock the Boss Battle to this session
    UPDATE projects 
    SET 
      boss_battle_locked_at = NOW(),
      boss_battle_session_id = NEW.id
    WHERE id = NEW.project_id;
    
    -- Log for debugging
    RAISE NOTICE 'Boss Battle project % locked by session %', NEW.project_id, NEW.id;
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to automatically lock Boss Battle when session starts
CREATE TRIGGER lock_boss_battle
AFTER INSERT ON sessions
FOR EACH ROW
EXECUTE FUNCTION lock_boss_battle_on_session_start();

-- Function to unlock Boss Battle when project is completed or abandoned
CREATE OR REPLACE FUNCTION unlock_boss_battle_on_completion()
RETURNS TRIGGER AS $$
BEGIN
  -- Only proceed if status is changing to completed or abandoned
  IF (NEW.status IN ('completed', 'abandoned') AND OLD.status NOT IN ('completed', 'abandoned')) THEN
    -- If this was a Boss Battle, clear the lock
    IF NEW.is_boss_battle = TRUE THEN
      NEW.boss_battle_locked_at := NULL;
      NEW.boss_battle_session_id := NULL;
      -- Also set is_boss_battle to false since it's done
      NEW.is_boss_battle := FALSE;
      -- But preserve that it WAS a boss battle for XP calculation
      NEW.was_boss_battle := TRUE;
      
      RAISE NOTICE 'Boss Battle project % unlocked due to %', NEW.id, NEW.status;
    END IF;
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to unlock Boss Battle when completed
CREATE TRIGGER unlock_boss_battle
BEFORE UPDATE ON projects
FOR EACH ROW
EXECUTE FUNCTION unlock_boss_battle_on_completion();

-- Materialized view for analytics dashboard (Priority 4 optimization)
CREATE MATERIALIZED VIEW user_analytics AS
SELECT 
  u.id as user_id,
  
  -- Project metrics
  COUNT(DISTINCT p.id) FILTER (WHERE p.status = 'completed') as projects_completed,
  COUNT(DISTINCT p.id) FILTER (WHERE p.status = 'abandoned') as projects_abandoned,
  COUNT(DISTINCT p.id) FILTER (WHERE p.status = 'active') as projects_active,
  
  -- Focus session metrics
  COUNT(DISTINCT s.id) FILTER (WHERE s.completed = true) as sessions_completed,
  COALESCE(SUM(s.duration) FILTER (WHERE s.completed = true), 0) as total_focus_minutes,
  MAX(s.date) as last_session_date,
  
  -- This week's metrics (computed dynamically)
  COUNT(DISTINCT s.id) FILTER (WHERE s.completed = true 
    AND s.date >= date_trunc('week', CURRENT_DATE)) as week_sessions,
  COALESCE(SUM(s.duration) FILTER (WHERE s.completed = true 
    AND s.date >= date_trunc('week', CURRENT_DATE)), 0) as week_focus_minutes,
  
  -- XP metrics
  COALESCE(SUM(xp.amount) FILTER (WHERE xp.week_start = date_trunc('week', CURRENT_DATE)), 0) as current_week_xp,
  
  NOW() as refreshed_at
FROM 
  auth.users u
  LEFT JOIN projects p ON p.user_id = u.id
  LEFT JOIN sessions s ON s.user_id = u.id
  LEFT JOIN xp_events xp ON xp.user_id = u.id
GROUP BY u.id;

-- Index for fast lookups
CREATE UNIQUE INDEX ON user_analytics(user_id);

-- Refresh function (call after major operations)
CREATE OR REPLACE FUNCTION refresh_user_analytics()
RETURNS void AS $$
BEGIN
  REFRESH MATERIALIZED VIEW CONCURRENTLY user_analytics;
END;
$$ LANGUAGE plpgsql;
```


## Payment Flow & Support Model

### 14-Day Full Access Experience
**Complete access for 14 days:**
- All features unlocked - no restrictions
- No credit card required to start
- No pressure, no countdown timers
- Day 14: Supportive popup invitation
- After 14 days â†’ Read-only mode until support

### Two-Tier Support Pricing
**One-time payment via Buy Me a Coffee:**
- **Standard Supporter**: $59.99 lifetime access
  - "If this saves you 1 hour/month, it's worth it"
- **Student/Hardship**: $29.99 lifetime access  
  - "Money's tight but I want in - no questions asked"
  - Honor system - no verification required

### Why This Model?
- **Trust First**: Full access shows confidence in value
- **Inclusive**: Student pricing removes barriers
- **Sustainable**: Higher standard price subsidizes student tier
- **Human**: Acknowledges different financial realities

### Technical Flow
1. **User signs up** â†’ Full access for 14 days
2. **Day 14** â†’ Show support popup with usage stats
3. **User chooses tier** â†’ Redirect to Buy Me a Coffee
4. **BMC payment** â†’ Simple webhook to Supabase
5. **Edge Function** â†’ Updates user_profiles.has_lifetime_access = true
6. **User returns** â†’ Lifetime access activated

### Day 14 Support Popup Copy
```markdown
## Hey, it's been 2 weeks! ðŸ‘‹

You've been rebelling against productivity theater for 14 days.
[X projects created] [Y focus sessions] [Z hours deep work]

If this app is helping you get things done, I'd love your support 
to keep improving it. One-time payment, lifetime access, all future features.

ðŸ’ª Standard Supporter - $59.99
   "I believe in this rebellion"

ðŸŽ“ Student/Hardship - $29.99  
   "Money's tight but I want in"
   (No questions asked. We've all been there.)

This is not a subscription. Pay once, rebel forever.
```

### Edge Function for Buy Me a Coffee Webhook
```typescript
// supabase/functions/bmc-webhook/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

// Much simpler than PayPal!
const BMC_WEBHOOK_SECRET = Deno.env.get('BMC_WEBHOOK_SECRET')!

serve(async (req) => {
  try {
    const payload = await req.json()
    
    // BMC sends clean, simple webhook data
    if (payload.type === 'membership.started' || payload.type === 'donation') {
      const email = payload.email
      const amount = payload.amount
      const supporterName = payload.supporter_name || 'Anonymous'
      const isStudent = amount <= 30 // Student tier detection
      
      // Initialize Supabase admin client
      const supabaseUrl = Deno.env.get('SUPABASE_URL')!
      const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
      const supabase = createClient(supabaseUrl, supabaseServiceKey)
      
      // Grant lifetime access - much simpler than PayPal!
      const { error } = await supabase.rpc('grant_lifetime_access', {
        user_email: email,
        amount: amount,
        supporter_name: supporterName,
        support_tier: isStudent ? 'student' : 'standard'
      })
      
      if (error) {
        console.error('Failed to grant access:', error)
        return new Response('Processing failed', { status: 500 })
      }
      
      // Optional: Send thank you email
      console.log(`Lifetime access granted to ${email} (${isStudent ? 'Student' : 'Standard'} tier)`)
    }
    
    return new Response('OK', { status: 200 })
  } catch (error) {
    console.error('Webhook error:', error)
    return new Response('Internal Server Error', { status: 500 })
  }
})
```

### UI States
**First 14 Days:**
- No payment UI at all - full focus on value
- Optional: Subtle "Day X of 14" in footer
- Complete feature access

**Day 14 - Support Request:**
- Popup with usage statistics
- Two-tier pricing clearly explained
- "Maybe Later" option available
- Can view all data but cannot create/edit after dismissing

**Lifetime Access (Post-Support):**
- No payment-related UI ever again
- Optional: "Supporter Since [Date]" badge
- Full feature access forever
- Access to all future AI features when added

## Future Features & Ideas

### Out of Scope for MVP
**Core Platform:**
- Mobile app (web-first approach, desktop-only initially)
- Mobile responsive design
- Onboarding tutorial flow

**Integrations:**
- External tool connections (Notion, Todoist, Google Calendar)
- Export data functionality
- Voice capture option

**Social & AI:**
- Social features or sharing capabilities
- AI-powered suggestions or insights

### Post-MVP Enhancements

**Core Mechanics (Priority 1 - Add Soon):**
- **Triage Undo**: 5-second undo window after triage decisions
- **XP Daily Decay**: Progressive XP reduction (1st session 100%, 2nd 75%, 3rd 50%, 4th+ 25%)
- **Session Interrupted vs Abandoned**: Track why sessions didn't complete

**Developer Tools & Integrations (Priority 2):**
- **Quick Capture API**: REST endpoint for Alfred/Raycast/Shortcuts integration
  - Global hotkey â†’ capture from anywhere â†’ auto-parse cost/benefit
  - API key authentication for external tools
  - Webhook support for Zapier/Make/IFTTT
- **Error Tracking (Sentry)**: Production error monitoring and stack traces
  - User session replay for debugging
  - Performance monitoring for slow queries
  - Release tracking and regression alerts
- **Analytics (PostHog)**: Privacy-first usage analytics
  - Feature adoption funnels
  - User journey mapping
  - A/B testing framework
  - Session recordings (optional)

**Analytics & Intelligence:**
- **Personalized Patterns**: "You complete Build projects 2x faster than Learn projects"
- **Optimal Timing**: "Your best time for high-cost projects is Tuesday afternoons"
- **Success Patterns**: "Projects created after focus sessions have 80% completion rate"
- **Burnout Prediction**: Alert when too many high-cost projects are active
- **Project Templates**: Auto-suggest cost/benefit based on similar past projects
- **Character Classes System**: Unlock user archetypes after 1 week of usage
- **End-of-Week Recap**: Personalized insights and pattern recognition

**Focus Session Evolution:**
- **Partial Credit System**: Sliding XP scale based on % completed (not binary)
- **Technical Resilience**: Auto-save session state every minute for crash recovery
- **Flow State Recognition**: Subtle indication after 20 minutes of deep focus
- **Flexible Durations**: Support 52/17, 45/15, and custom time splits
- **Progressive Session Lengths**: Start with 25 min, gradually work up to 90 min
- **Co-working Mode**: Virtual focus sessions with others
- **Focus Sounds**: Optional white noise, nature sounds, or silence

**Advanced Tracking:**
- **Ultradian Rhythm Tracking**: Show user's natural 90-minute productivity peaks
- **Energy Pattern Analysis**: "Your high-energy time is typically 10am-12pm"
- **Time Estimation**: "This project typically takes 3 focus sessions"

## Annex 2 : Essence & Inspiration

### Core Essence
**What it does:**
  - Build consistent deep focus habits through visual project management and session-based work tracking.
  - Serious productivity methodology (GTD, Deep Work) + gaming culture references + acknowledgment of human imperfection = sustainable habit formation without the guilt.
**How it does it:**
  - **Opinionated structure** where it matters 
  - **subtle Gaming language for relief stress** without patronizing 
  - **Visual discovery** over explanation 
  - **subtle celebration** XP counts up with animations, no achievement popups.
  - **Self-aware, gentle auto-derision to keep perspective humor**
  - **App doesn't take itself too seriously** trying to move the needle in the haystack the right way. 

### Success Indicators
Users feel they have a **practical tool with personality** - one that doesn't take itself too seriously but genuinely helps move the needle forward. It's grounded in proven methodologies (GTD, habit loops, project management) but delivered with gaming references and gentle self-deprecation. The app acknowledges human imperfection ("Total guess" confidence, "Meh" mindset) while subtly nudging toward better habits. Success means users actually finish projects, build consistent deep work practice, and maybe even smile at "Hail to the King" difficulty instead of dreading the grind.


### Methodologies & Research
- **Getting Things Done (GTD)** by David Allen - Core capture/triage workflow, cognitive load relief
- **The Power of Habit** by Charles Duhigg - Cue/routine/reward loop, habit formation without forcing
- **Ricardo Vargas PM Simplified** - Visual project management on scatter plots (famous YouTube video)
- **Deep Work** by Cal Newport - Focus session philosophy, flow state protection

### App Inspirations  
- **Strava/Whoop** - Personal records, weekly streaks, effort-based rewards over outcomes
- **Duke Nukem 3D** - Difficulty quotes ("Come Get Some", "Hail to the King")
- **Dark Souls** - Achievement naming, difficulty as badge of honor not punishment
- **CS50 Duck Debugger** - Yellow duck friend for journaling/self-reflection
- **Elden Ring** - Looking for sublime and perfection in execution and art design, trusting user intelligence. 

### Design Philosophy
- **Neobrutalism** - Bold, unapologetic visual style that doesn't blend into corporate blandness
- **Gamification** - Achievements, XP, difficulty levels, streaks, etc.
- **Visual-First Communication** - Maps over lists, colors over text, discovery over tutorials

